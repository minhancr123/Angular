<div class="col-xl-12">
  <app-card cardTitle="{{ 'customermanagement.title' | translate }}" [options]="false" blockClass="table-border-style">
    
    <!-- Toolbar/Header -->
    <div class="d-flex justify-content-between align-items-center flex-wrap mb-3">
      <div class="d-flex align-items-center gap-2 flex-grow-1">
        <!-- Tựa đề -->
        <h5 class="mb-0">{{ 'customermanagement.title' | translate }}</h5>

        <!-- Ô tìm kiếm -->
        <div class="position-relative ms-3" *ngIf="showSearch">
          <input
            type="text"
            class="form-control"
            placeholder="{{ 'Tìm kiếm theo tên khách hàng, code' | translate }}"
            (input)="changeKeyword($event)"
            #searchInput>
        </div>
      </div>

      <!-- Nút chức năng -->
      <div class="btn-group">
        <button class="btn btn-outline-secondary me-2" (click)="import()">
          {{ 'COMMOM.IMPORTKHACHHANG' | translate }}
        </button>
        <button class="btn btn-danger" (click)="create()">
          {{ 'COMMOM.THEMKHACHHANG' | translate }}
        </button>
      </div>
    </div>

    <!-- Bộ lọc -->
    <div class="btn-group mb-3 flex-wrap">
      <button class="btn btn-outline-secondary me-2 mb-2" (click)="filterDaKhoa()">
        {{ 'customermanagement.dakhoa' | translate }}
        <span *ngIf="dateFilter">({{ dateFilter.IsLock }})</span>
      </button>
      <button class="btn btn-outline-primary me-2 mb-2" (click)="filterDangSuDung()">
        {{ 'customermanagement.dangsudung' | translate }}
        <span *ngIf="dateFilter">({{ dateFilter.IsUsed }})</span>
      </button>
      <button class="btn btn-outline-info me-2 mb-2" (click)="filterSapHetHan()">
        {{ 'customermanagement.saphethan' | translate }}
        <span *ngIf="dateFilter">({{ dateFilter.SapHetHan }})</span>
      </button>
      <button class="btn btn-outline-danger me-2 mb-2" (click)="filterDaHetHan()">
        {{ 'customermanagement.dahethan' | translate }}
        <span *ngIf="dateFilter">({{ dateFilter.HetHan }})</span>
      </button>
      <button class="btn btn-outline-primary me-2 mb-2" (click)="filterAll()">
        {{ 'customermanagement.tatca' | translate }}
        <span *ngIf="dateFilter">({{ dateFilter.All }})</span>
      </button>
    </div>

    <!-- Bảng dữ liệu -->
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>{{ 'customermanagement.thongtinkhachhang' | translate }}</th>
            <th>{{ 'customermanagement.thongtinnguoihotro' | translate }}</th>
            <th>{{ 'customermanagement.thongtinsudung' | translate }}</th>
            <th>{{ 'customermanagement.dienthoainguoidaidien' | translate }}</th>
            <th>{{ 'COMMOM.THAOTAC' | translate }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of customerManagementService.items$ | async">
            <!-- Thông tin khách hàng -->
            <td>
              <a [routerLink]="['info', r.RowID]">
                <div class="fw-bold">{{ r.Code }}</div>
                <div>{{ r.CompanyName }} - {{ getDate(r.RegisterDate) }}</div>
                <div>
                  <strong>{{ r.RegisterName }}</strong>: 
                  <em>{{ 'customermanagement.taoboijeecustomer' | translate }} {{ getDateTime(r.RegisterDate) }}</em>
                </div>
              </a>
            </td>

            <!-- Người hỗ trợ -->
            <td>
              <div>{{ r.SupporterName }}</div>
              <div>{{ r.SupporterEmail }}</div>
              <div>{{ r.SupporterPhone }}</div>
            </td>

            <!-- Thông tin sử dụng -->
            <td>
              <div>{{ 'customermanagement.soluonghoso' | translate }}</div>
              <div>{{ 'customermanagement.ngaydenhan' | translate }}</div>
            </td>

            <!-- Điện thoại -->
            <td>{{ r.Phone }}</td>

          <td>
  <button mat-icon-button [matMenuTriggerFor]="menu">
    <mat-icon>more_vert</mat-icon>
  </button>

  <mat-menu #menu="matMenu" class="bg-light">
    <button mat-menu-item class="text-primary" (click)="giaHan(r)">
      <mat-icon class="me-2">event</mat-icon>
      {{ 'customermanagement.giahanngaysudung' | translate }}
    </button>

    <button mat-menu-item class="text-success" (click)="addNumberStaff(r)">
      <mat-icon class="me-2">group_add</mat-icon>
      {{ 'customermanagement.themsoluongnhanvien' | translate }}
    </button>

    <button mat-menu-item class="text-warning" (click)="addDeleteApp(r)">
      <mat-icon class="me-2">apps</mat-icon>
      {{ 'customermanagement.themxoaungdung' | translate }}
    </button>

    <button mat-menu-item class="text-info" (click)="resetPassword(r)">
      <mat-icon class="me-2">lock_reset</mat-icon>
      {{ 'customermanagement.resetmatkhau' | translate }}
    </button>

    <button mat-menu-item class="text-danger" *ngIf="r.Status == 1" (click)="lockCustomer(r)">
      <mat-icon class="me-2">lock</mat-icon>
      {{ 'customermanagement.khoakhachhang' | translate }}
    </button>

    <button mat-menu-item class="text-success" *ngIf="r.Status == 0" (click)="unLockCustomer(r)">
      <mat-icon class="me-2">lock_open</mat-icon>
      {{ 'customermanagement.mokhoakhachhang' | translate }}
    </button>
  </mat-menu>
</td>

          </tr>
        </tbody>
      </table>
    </div>

    <!-- Phân trang -->
    <div class="mt-3">
      <app-paginator
        [paginator]="paginator"
        [isLoading]="isLoading"
        (paginate)="paginate($event)">
      </app-paginator>
    </div>

  </app-card>
</div>
